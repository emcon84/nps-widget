<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NPS Widget Din√°mico - Demo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .demo-container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        background: white;
        border-radius: 16px;
        padding: 40px;
        margin-bottom: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 12px;
      }

      .subtitle {
        font-size: 1.125rem;
        color: #6b7280;
        margin-bottom: 8px;
      }

      .description {
        color: #6b7280;
        font-size: 0.875rem;
        line-height: 1.6;
        max-width: 600px;
        margin: 0 auto;
      }

      .features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .feature-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      .feature-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .feature-description {
        color: #6b7280;
        font-size: 0.875rem;
        line-height: 1.6;
      }

      .widget-container {
        background: white;
        border-radius: 16px;
        padding: 40px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
      }

      .widget-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 20px;
        text-align: center;
      }

      .controls {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      .controls-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 16px;
      }

      .control-group {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 16px;
      }

      .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .btn-primary {
        background: #3b82f6;
        color: white;
      }

      .btn-primary:hover {
        background: #2563eb;
      }

      .btn-secondary {
        background: #f3f4f6;
        color: #374151;
        border: 1px solid #d1d5db;
      }

      .btn-secondary:hover {
        background: #e5e7eb;
      }

      .btn-danger {
        background: #ef4444;
        color: white;
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      .status {
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 16px;
        font-family: "Monaco", "Consolas", monospace;
        font-size: 12px;
        white-space: pre-wrap;
        max-height: 200px;
        overflow-y: auto;
      }

      .icon {
        width: 20px;
        height: 20px;
      }

      @media (max-width: 768px) {
        .title {
          font-size: 2rem;
        }

        .control-group {
          flex-direction: column;
        }

        .btn {
          text-align: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="demo-container">
      <div class="header">
        <h1 class="title">üöÄ NPS Widget Din√°mico</h1>
        <p class="subtitle">Actualizaciones Autom√°ticas en Tiempo Real</p>
        <p class="description">
          Este widget se actualiza autom√°ticamente cuando realizas cambios en la
          encuesta desde el dashboard. No necesitas recargar la p√°gina ni volver
          a embeber el c√≥digo.
        </p>
      </div>

      <div class="features">
        <div class="feature-card">
          <h3 class="feature-title">
            <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
              <path
                d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm2 6a2 2 0 100-4 2 2 0 000 4zm8-2a2 2 0 11-4 0 2 2 0 014 0zM6 12a2 2 0 100-4 2 2 0 000 4zm8 0a2 2 0 100-4 2 2 0 000 4z"
              />
            </svg>
            Actualizaciones Autom√°ticas
          </h3>
          <p class="feature-description">
            El widget verifica autom√°ticamente cada 30 segundos si hay cambios
            en la encuesta y se actualiza sin intervenci√≥n manual.
          </p>
        </div>

        <div class="feature-card">
          <h3 class="feature-title">
            <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
              <path
                fillRule="evenodd"
                d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                clipRule="evenodd"
              />
            </svg>
            Manejo Inteligente de Errores
          </h3>
          <p class="feature-description">
            Sistema de reintentos autom√°ticos y notificaciones claras de errores
            con opciones de recuperaci√≥n manual.
          </p>
        </div>

        <div class="feature-card">
          <h3 class="feature-title">
            <svg class="icon" fill="currentColor" viewBox="0 0 20 20">
              <path
                fillRule="evenodd"
                d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                clipRule="evenodd"
              />
            </svg>
            API de Control
          </h3>
          <p class="feature-description">
            Controla el widget program√°ticamente con funciones para recargar,
            verificar actualizaciones y obtener el estado.
          </p>
        </div>
      </div>

      <div class="widget-container">
        <h2 class="widget-title">Widget en Acci√≥n</h2>
        <div id="nps-dynamic-widget"></div>
      </div>

      <div class="controls">
        <h3 class="controls-title">Controles de Demostraci√≥n</h3>

        <div class="control-group">
          <button class="btn btn-primary" onclick="reloadWidget()">
            üîÑ Recargar Widget
          </button>
          <button class="btn btn-secondary" onclick="checkUpdates()">
            üîç Verificar Actualizaciones
          </button>
          <button class="btn btn-secondary" onclick="getWidgetState()">
            üìä Obtener Estado
          </button>
          <button class="btn btn-secondary" onclick="testConnectivity()">
            üåê Probar Conectividad
          </button>
          <button class="btn btn-danger" onclick="simulateError()">
            ‚ö†Ô∏è Simular Error
          </button>
        </div>

        <div class="control-group">
          <button class="btn btn-secondary" onclick="toggleAutoUpdates()">
            ‚è∞ Toggle Auto-Updates
          </button>
          <button class="btn btn-secondary" onclick="clearConsole()">
            üßπ Limpiar Consola
          </button>
        </div>

        <h4 style="margin: 16px 0 8px 0; color: #374151">Estado del Widget:</h4>
        <div id="widget-status" class="status">Cargando widget...</div>
      </div>
    </div>

    <!-- El script din√°mico del widget -->
    <script>
      // Configuraci√≥n din√°mica de la URL base
      const BASE_URL =
        window.location.hostname === "localhost" ||
        window.location.hostname === "127.0.0.1"
          ? "http://localhost:3000"
          : "https://your-production-domain.com";

      // Crear y cargar el script del widget din√°micamente
      const script = document.createElement("script");
      script.src = `${BASE_URL}/api/surveys/sample-survey/script?container=nps-dynamic-widget&updateInterval=30000`;
      script.onerror = function () {
        document.getElementById("nps-dynamic-widget").innerHTML = `
                <div style="
                    padding: 20px;
                    background: #fef2f2;
                    color: #dc2626;
                    border: 1px solid #fecaca;
                    border-radius: 8px;
                    text-align: center;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                ">
                    <h3 style="margin: 0 0 8px 0;">No se pudo cargar el widget</h3>
                    <p style="margin: 0; font-size: 14px;">
                        Aseg√∫rate de que el servidor est√© corriendo en <strong>${BASE_URL}</strong>
                    </p>
                    <button onclick="location.reload()" style="
                        margin-top: 12px;
                        padding: 8px 16px;
                        background: #dc2626;
                        color: white;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 12px;
                    ">
                        Reintentar
                    </button>
                </div>
            `;
      };
      document.head.appendChild(script);
    </script>

    <div id="nps-nps-survey-1756765545837"></div>
    <script>
      (function () {
        const c = {
          id: "nps-survey-1756765545837",
          elements: [
            {
              id: "nps-1756765522781",
              type: "nps",
              label: "¬øQu√© tan probable es que recomiendes nuestro producto?",
              required: true,
              minValue: 0,
              maxValue: 10,
              minLabel: "Nada probable",
              maxLabel: "Muy probable",
              displayType: "numbers",
            },
          ],
          style: {
            fontFamily: "Arial, sans-serif",
            primaryColor: "#3b82f6",
            backgroundColor: "#ffffff",
            borderRadius: "8px",
          },
          settings: {
            errorMessage: "Error al enviar. Por favor intenta de nuevo.",
            submitMethod: "POST",
            submitEndpoint: "",
            successMessage: "¬°Gracias por tu feedback!",
            webhookHeaders: {},
          },
        };
        const d = document,
          s = d.createElement("style");
        s.textContent = `.nw{max-width:600px;margin:20px auto;padding:24px;background:#fff;border-radius:8px;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);font-family:Arial,sans-serif}.ne{margin-bottom:20px}.nl{display:block;font-weight:600;margin-bottom:8px;color:#374151}.nr{color:#ef4444}.ns{display:flex;gap:8px;justify-content:space-between;margin:16px 0}.nb{flex:1;padding:12px 8px;border:2px solid #d1d5db;border-radius:6px;background:#fff;cursor:pointer;transition:all 0.2s;font-weight:500;text-align:center}.nb:hover{border-color:${c.style.primaryColor};background:${c.style.primaryColor}15}.nb.sel{border-color:${c.style.primaryColor};background:${c.style.primaryColor};color:#fff}.ni{width:100%;padding:12px;border:2px solid #d1d5db;border-radius:6px;font-size:14px}.ni:focus{outline:none;border-color:${c.style.primaryColor}}.btn{background:${c.style.primaryColor};color:#fff;padding:12px 24px;border:none;border-radius:6px;font-weight:600;cursor:pointer}`;
        d.head.appendChild(s);
        let h = '<div class="nw">';
        c.elements.forEach((e) => {
          h += '<div class="ne">';
          if (e.type === "nps") {
            h += `<label class="nl">${e.label}${e.required ? ' <span class="nr">*</span>' : ""}</label><div style="display:flex;justify-content:space-between;margin-bottom:8px;font-size:12px;color:#6b7280"><span>${e.minLabel || "Not likely"}</span><span>${e.maxLabel || "Very likely"}</span></div><div class="ns" data-id="${e.id}">`;
            for (let i = e.minValue; i <= e.maxValue; i++) {
              h += `<button type="button" class="nb" data-v="${i}">${i}</button>`;
            }
            h += "</div>";
          } else if (e.type === "text-input") {
            h += `<label class="nl">${e.label}${e.required ? ' <span class="nr">*</span>' : ""}</label><input type="text" class="ni" placeholder="${e.placeholder || ""}" data-id="${e.id}">`;
          } else if (e.type === "textarea") {
            h += `<label class="nl">${e.label}${e.required ? ' <span class="nr">*</span>' : ""}</label><textarea class="ni" placeholder="${e.placeholder || ""}" data-id="${e.id}" rows="${e.rows || 4}"></textarea>`;
          } else if (e.type === "select") {
            h += `<label class="nl">${e.label}${e.required ? ' <span class="nr">*</span>' : ""}</label><select class="ni" data-id="${e.id}"><option value="">${e.placeholder || "Choose an option..."}</option>${e.options.map((o) => `<option value="${o}">${o}</option>`).join("")}</select>`;
          }
          h += "</div>";
        });
        h += '<button type="submit" class="btn">Submit Survey</button></div>';
        const el = d.getElementById("nps-" + c.id);
        el.innerHTML = h;
        el.querySelectorAll(".nb").forEach((b) =>
          b.addEventListener("click", function () {
            this.parentElement
              .querySelectorAll(".nb")
              .forEach((x) => x.classList.remove("sel"));
            this.classList.add("sel");
          })
        );
        el.querySelector(".btn").addEventListener("click", async function () {
          const fd = {};
          el.querySelectorAll(".ns .sel").forEach(
            (b) => (fd[b.parentElement.dataset.id] = b.dataset.v)
          );
          el.querySelectorAll(".ni").forEach((i) => {
            if (i.value) fd[i.dataset.id] = i.value;
          });
          const data = {
            timestamp: new Date().toISOString(),
            formId: c.id,
            responses: fd,
            userAgent: navigator.userAgent,
            pageUrl: location.href,
          };
          if (c.settings.submitEndpoint) {
            try {
              this.disabled = true;
              this.textContent = "Enviando...";
              const r = await fetch(c.settings.submitEndpoint, {
                method: c.settings.submitMethod,
                headers: {
                  "Content-Type": "application/json",
                  ...c.settings.webhookHeaders,
                },
                body: JSON.stringify(data),
              });
              if (r.ok) {
                el.innerHTML = `<div style="text-align:center;padding:40px;color:#10b981"><h3 style="margin:0 0 8px 0">${c.settings.successMessage}</h3><p style="margin:0;color:#6b7280">Tu respuesta ha sido registrada.</p></div>`;
              } else throw new Error("Server error");
            } catch (e) {
              console.error("Error:", e);
              const err = d.createElement("div");
              err.style.cssText =
                "background:#fef2f2;color:#dc2626;padding:12px;border-radius:6px;margin-top:16px;text-align:center";
              err.textContent = c.settings.errorMessage;
              el.appendChild(err);
              this.disabled = false;
              this.textContent = "Submit Survey";
            }
          } else {
            console.log("Survey Data:", data);
            alert("Survey submitted!");
          }
        });
      })();
    </script>
  </body>
</html>
